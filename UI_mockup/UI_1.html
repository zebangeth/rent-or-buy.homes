<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buy vs. Rent Calculator - Alternative Design</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f5f3ff",
                100: "#ede9fe",
                200: "#ddd6fe",
                300: "#c4b5fd",
                400: "#a78bfa",
                500: "#8b5cf6",
                600: "#7c3aed",
                700: "#6d28d9",
                800: "#5b21b6",
                900: "#4c1d95",
              },
              secondary: {
                50: "#ecfdf5",
                100: "#d1fae5",
                200: "#a7f3d0",
                300: "#6ee7b7",
                400: "#34d399",
                500: "#10b981",
                600: "#059669",
                700: "#047857",
                800: "#065f46",
                900: "#064e3b",
              },
              dark: {
                50: "#f8fafc",
                100: "#f1f5f9",
                200: "#e2e8f0",
                300: "#cbd5e1",
                400: "#94a3b8",
                500: "#64748b",
                600: "#475569",
                700: "#334155",
                800: "#1e293b",
                900: "#0f172a",
                950: "#030712",
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        font-family: "Montserrat", sans-serif;
        background-color: #f3f4f6;
      }

      /* Custom slider styles */
      input[type="range"] {
        -webkit-appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 10px;
        background: #e5e7eb;
        outline: none;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #8b5cf6;
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
      }
      .card {
        border-radius: 16px;
        background: white;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }
      .glow-primary {
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
      }
      .glow-secondary {
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
      }
      .tab-active {
        position: relative;
      }
      .tab-active::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 0;
        width: 100%;
        height: 3px;
        background: #8b5cf6;
        border-radius: 3px;
      }

      /* Toggle Switch Styles */
      input:checked ~ .dot {
        transform: translateX(1rem);
        background-color: #8b5cf6; /* primary-500 */
      }
      input:checked ~ .block {
        background-color: #c4b5fd; /* primary-300 */
      }

      /* Notification Animation */
      .animate-fade-in-out {
        animation: fadeInOut 3.5s ease-in-out;
        transition: opacity 0.5s ease;
      }

      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translateY(-10px);
        }
        10% {
          opacity: 1;
          transform: translateY(0);
        }
        90% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
    </style>
  </head>
  <body class="bg-white min-h-screen">
    <!-- App Content -->
    <div class="w-full max-w-6xl mx-auto min-h-screen">
      <div class="px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <header class="mb-10 border-b border-gray-200 pb-6">
          <div class="flex justify-between items-center mb-4">
            <div>
              <h1 class="text-4xl font-bold text-dark-800 inline-block">
                <span class="font-medium text-dark-500">Should I</span>
                <span class="text-primary-600">Buy</span>
                <span class="font-medium text-dark-500">or</span>
                <span class="text-secondary-600">Rent</span>
                <span class="font-medium text-dark-500">a House?</span>
              </h1>
            </div>
            <div class="flex items-center space-x-3">
              <!-- Language Switch -->
              <div class="relative">
                <select
                  id="languageSwitch"
                  class="appearance-none text-sm font-medium text-dark-600 bg-gray-100 pl-8 pr-8 py-2 rounded-full cursor-pointer hover:bg-gray-200 transition focus:outline-none focus:ring-2 focus:ring-primary-500"
                >
                  <option value="en">ðŸ‡ºðŸ‡¸ English</option>
                  <option value="zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</option>
                  <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
                  <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2">
                  <i class="fas fa-globe text-dark-500"></i>
                </div>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
                  <i class="fas fa-chevron-down text-xs text-dark-500"></i>
                </div>
              </div>

              <!-- GitHub Link -->
              <a
                href="https://github.com/yourusername/rent-or-buy"
                target="_blank"
                rel="noopener noreferrer"
                class="bg-dark-800 text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-dark-700 transition flex items-center"
                title="View on GitHub"
              >
                <i class="fab fa-github mr-1"></i> GitHub
              </a>
            </div>
          </div>
          <p class="text-dark-500 max-w-2xl">
            This website helps you compare the financial outcomes of buying vs renting to see which option makes more
            financial sense.
          </p>
        </header>

        <!-- Hero Section -->
        <div class="mb-10">
          <div
            class="card bg-gradient-to-r from-primary-50 to-secondary-50 p-8 border border-gray-200 relative overflow-hidden"
          >
            <!-- Main Content -->
            <div class="flex flex-col lg:flex-row gap-8">
              <!-- Explanation Section -->
              <div class="flex-1">
                <!-- Conclusion -->
                <div class="bg-primary-600 text-white px-4 py-2 rounded-lg inline-block mb-4">
                  <div class="flex items-center font-bold">
                    <i class="fas fa-trophy mr-2"></i>
                    <span>Buying is the better option</span>
                  </div>
                </div>

                <!-- Time Horizon Selector -->
                <div class="mb-6">
                  <div class="flex items-center space-x-3 mb-3">
                    <span class="text-sm font-medium text-dark-600">View projection for:</span>
                    <div class="flex bg-gray-100 rounded-lg p-1">
                      <button
                        class="time-horizon-btn active px-3 py-1 text-sm font-medium rounded-md bg-primary-600 text-white transition"
                        data-years="10"
                      >
                        10 years
                      </button>
                      <button
                        class="time-horizon-btn px-3 py-1 text-sm font-medium rounded-md text-dark-600 hover:bg-gray-200 transition"
                        data-years="15"
                      >
                        15 years
                      </button>
                      <button
                        class="time-horizon-btn px-3 py-1 text-sm font-medium rounded-md text-dark-600 hover:bg-gray-200 transition"
                        data-years="20"
                      >
                        20 years
                      </button>
                      <button
                        class="time-horizon-btn px-3 py-1 text-sm font-medium rounded-md text-dark-600 hover:bg-gray-200 transition"
                        data-years="30"
                      >
                        30 years
                      </button>
                    </div>
                  </div>
                </div>

                <p class="text-xl md:text-2xl leading-relaxed text-dark-800 mb-1 font-medium">
                  If you buy a $2,500,000 home today and it grows to <span id="future-home-value">$3,500,000</span> in
                  <span id="projection-years">10</span> years, your net worth would be
                  <span class="font-bold text-primary-700 border-b-2 border-primary-300" id="buy-net-worth"
                    >$3,120,000</span
                  >.
                </p>
                <p class="text-xl md:text-2xl leading-relaxed text-dark-800 mb-5 font-medium">
                  If you rent for $6,000/month and invest the difference, your net worth would be
                  <span class="font-bold text-secondary-700 border-b-2 border-secondary-300" id="rent-net-worth"
                    >$2,850,000</span
                  >.
                </p>
                <div class="text-sm text-dark-500 bg-white bg-opacity-60 rounded-lg p-3">
                  <div class="font-medium mb-2">Key Assumptions:</div>
                  <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                    <div class="flex items-center">
                      <i class="fas fa-home text-primary-500 mr-2"></i>
                      <span>Home value: <span class="font-medium">$2,500,000</span></span>
                    </div>
                    <div class="flex items-center">
                      <i class="fas fa-key text-secondary-500 mr-2"></i>
                      <span>Current rent: <span class="font-medium">$6,000/mo</span></span>
                    </div>
                    <div class="flex items-center">
                      <i class="fas fa-percentage text-primary-500 mr-2"></i>
                      <span>Down payment: <span class="font-medium">25%</span></span>
                    </div>
                    <div class="flex items-center">
                      <i class="fas fa-chart-line text-secondary-500 mr-2"></i>
                      <span>Investment returns: <span class="font-medium">9.25%/yr</span></span>
                    </div>
                    <div class="flex items-center">
                      <i class="fas fa-trending-up text-primary-500 mr-2"></i>
                      <span>Home appreciation: <span class="font-medium">3.5%/yr</span></span>
                    </div>
                    <div class="flex items-center">
                      <i class="fas fa-arrow-up text-secondary-500 mr-2"></i>
                      <span>Rent increase: <span class="font-bold text-secondary-700">5%/year</span></span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Net Asset Value Breakdown -->
              <div class="lg:w-1/3 space-y-4">
                <!-- Buy Option -->
                <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-primary-500">
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                      <i class="fas fa-home text-primary-500 mr-2"></i>
                      <span class="font-semibold text-primary-700">Buy Option</span>
                    </div>
                    <span class="text-lg font-bold text-primary-600">$3,120,000</span>
                  </div>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                      <span class="text-dark-500">Property value:</span>
                      <span class="font-medium">$3,500,000</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-dark-500">Mortgage balance:</span>
                      <span class="font-medium">-$380,000</span>
                    </div>
                    <div class="flex justify-between border-t pt-2">
                      <span class="text-dark-600 font-medium">Net Asset Value:</span>
                      <span class="font-bold text-primary-600">$3,120,000</span>
                    </div>
                  </div>
                </div>

                <!-- Rent Option -->
                <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-secondary-500">
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                      <i class="fas fa-chart-line text-secondary-500 mr-2"></i>
                      <span class="font-semibold text-secondary-700">Rent + Invest</span>
                    </div>
                    <span class="text-lg font-bold text-secondary-600">$2,850,000</span>
                  </div>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                      <span class="text-dark-500">Initial investment:</span>
                      <span class="font-medium">$625,000</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-dark-500">Accumulated investments:</span>
                      <span class="font-medium">$1,180,000</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-dark-500">Investment growth:</span>
                      <span class="font-medium">$1,045,000</span>
                    </div>
                    <div class="flex justify-between border-t pt-2">
                      <span class="text-dark-600 font-medium">Net Asset Value:</span>
                      <span class="font-bold text-secondary-600">$2,850,000</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- CTA Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 mt-6 pt-6 border-t border-gray-200">
              <button
                id="edit-inputs-btn"
                class="flex-1 py-3 px-4 bg-dark-800 hover:bg-dark-700 text-white font-medium rounded-xl transition flex items-center justify-center"
              >
                <i class="fas fa-sliders-h mr-2"></i> Edit My Inputs
              </button>
              <button
                id="share-result-btn"
                class="flex-1 py-3 px-4 bg-gradient-to-r from-primary-600 to-secondary-600 hover:from-primary-700 hover:to-secondary-700 text-white font-medium rounded-xl transition flex items-center justify-center"
              >
                <i class="fas fa-share-alt mr-2"></i> Share This Result
              </button>
            </div>
          </div>
        </div>

        <!-- Dashboard -->
        <div class="flex flex-col md:flex-row gap-6">
          <!-- Left Section: Inputs -->
          <div class="w-full md:w-1/3 space-y-6">
            <!-- Input Card -->
            <div class="card p-6 border border-gray-100">
              <div class="flex items-center justify-between mb-6">
                <h2 class="text-lg font-semibold text-dark-800">
                  <i class="fas fa-sliders-h text-primary-500 mr-2"></i>Parameters
                </h2>
                <div class="relative inline-block">
                  <select
                    id="cityDefaults"
                    class="appearance-none text-xs font-medium text-primary-600 bg-primary-100 pl-7 pr-8 py-1 rounded-full cursor-pointer hover:bg-primary-200 transition focus:outline-none"
                  >
                    <option value="default">Smart Defaults</option>
                    <option value="sunnyvale">Sunnyvale, CA</option>
                    <option value="fremont">Fremont, CA</option>
                    <option value="bayarea">Bay Area, CA</option>
                    <option value="seattle">Seattle, WA</option>
                    <option value="austin">Austin, TX</option>
                    <option value="boston">Boston, MA</option>
                    <option value="nyc">New York, NY</option>
                    <option value="toronto">Toronto, ON</option>
                  </select>
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2">
                    <i class="fas fa-bolt text-primary-600"></i>
                  </div>
                  <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
                    <i class="fas fa-chevron-down text-xs text-primary-600"></i>
                  </div>
                </div>
              </div>

              <!-- Tabs for Input Categories -->
              <div class="flex justify-between mb-8">
                <button class="tab-active px-2 font-medium text-dark-800 text-sm">
                  <i class="fas fa-home mr-1"></i> Buy
                </button>
                <button class="text-dark-400 px-2 font-medium text-sm">
                  <i class="fas fa-key mr-1"></i><i class="fas fa-chart-line ml-1 mr-1"></i> Rent & Invest
                </button>
              </div>

              <!-- House Purchase Inputs -->
              <div class="space-y-6" id="buy-tab-content">
                <!-- House Price -->
                <div>
                  <div class="flex justify-between mb-3">
                    <label class="text-sm font-medium text-dark-700">Property Purchase Price</label>
                    <div class="px-3 py-1 bg-primary-100 text-primary-700 rounded-lg font-semibold text-sm">
                      $2,500,000
                    </div>
                  </div>
                  <input
                    type="range"
                    min="100000"
                    max="10000000"
                    value="2500000"
                    step="50000"
                    class="w-full"
                    data-id="housePrice"
                  />
                  <div class="flex justify-between text-xs text-dark-400 mt-1">
                    <span>$100K</span>
                    <span>$10M</span>
                  </div>
                </div>

                <!-- Down Payment -->
                <div>
                  <div class="flex justify-between mb-3">
                    <label class="text-sm font-medium text-dark-700">Down Payment</label>
                    <div class="px-3 py-1 bg-primary-100 text-primary-700 rounded-lg font-semibold text-sm">
                      25% ($625,000)
                    </div>
                  </div>
                  <input type="range" min="0" max="100" value="25" step="1" class="w-full" data-id="downPayment" />
                  <div class="flex justify-between text-xs text-dark-400 mt-1">
                    <span>0%</span>
                    <span>100%</span>
                  </div>
                </div>

                <!-- Interest Rate -->
                <div>
                  <div class="flex justify-between mb-3">
                    <label class="text-sm font-medium text-dark-700">Mortgage Interest Rate</label>
                    <div class="px-3 py-1 bg-primary-100 text-primary-700 rounded-lg font-semibold text-sm">6.75%</div>
                  </div>
                  <input type="range" min="2" max="10" value="6.75" step="0.25" class="w-full" data-id="interestRate" />
                  <div class="flex justify-between text-xs text-dark-400 mt-1">
                    <span>2%</span>
                    <span>10%</span>
                  </div>
                </div>

                <!-- Mortgage Term -->
                <div>
                  <div class="flex justify-between mb-3">
                    <label class="text-sm font-medium text-dark-700">Mortgage Term</label>
                  </div>
                  <div class="grid grid-cols-3 gap-2">
                    <button class="bg-primary-500 text-white p-2 rounded-lg text-sm font-medium">30 Years</button>
                    <button class="bg-gray-100 text-dark-500 p-2 rounded-lg text-sm font-medium">20 Years</button>
                    <button class="bg-gray-100 text-dark-500 p-2 rounded-lg text-sm font-medium">15 Years</button>
                  </div>
                </div>

                <!-- Expected Annual Home Appreciation -->
                <div>
                  <div class="flex justify-between mb-3">
                    <label class="text-sm font-medium text-dark-700">Expected Annual Home Appreciation</label>
                    <div class="px-3 py-1 bg-primary-100 text-primary-700 rounded-lg font-semibold text-sm">3.5%</div>
                  </div>
                  <input
                    type="range"
                    min="0"
                    max="10"
                    value="3.5"
                    step="0.5"
                    class="w-full"
                    data-id="homeAppreciation"
                  />
                  <div class="flex justify-between text-xs text-dark-400 mt-1">
                    <span>0%</span>
                    <span>10%</span>
                  </div>
                  <div class="text-xs text-dark-400 mt-1 italic">Based on historical average in your selected area</div>
                </div>

                <!-- Advanced Toggle -->
                <div class="mt-4 border-t border-gray-100 pt-4">
                  <button
                    id="advancedOptionsToggle"
                    class="flex w-full items-center justify-between text-dark-600 hover:text-primary-600 transition"
                  >
                    <span class="font-medium text-sm">Advanced Options</span>
                    <i class="fas fa-chevron-down text-xs"></i>
                  </button>

                  <!-- Advanced Options (Initially Hidden) -->
                  <div id="advancedOptionsContent" class="mt-4 space-y-3 bg-gray-50 p-4 rounded-xl">
                    <!-- Buying/Selling Transaction Costs Section -->
                    <div class="text-xs font-semibold text-dark-600 mb-2">Buying/Selling Transaction Costs</div>

                    <div class="flex justify-between items-center">
                      <label class="text-xs font-medium text-dark-600 flex items-center">
                        Closing Costs (Current Buy)
                        <div class="relative group ml-1">
                          <i class="fas fa-info-circle text-primary-400 text-xs"></i>
                          <div
                            class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 w-52 p-2 bg-dark-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10"
                          >
                            As a % of property price (e.g., loan origination, title, and other closing costs).
                          </div>
                        </div>
                      </label>
                      <div class="flex space-x-2 items-center">
                        <input type="number" value="2" class="w-16 p-1.5 text-xs text-center border rounded-lg" />
                        <span class="text-xs text-dark-500">%</span>
                      </div>
                    </div>

                    <div class="flex justify-between items-center">
                      <label class="text-xs font-medium text-dark-600 flex items-center">
                        Selling Costs (Future Sale)
                        <div class="relative group ml-1">
                          <i class="fas fa-info-circle text-primary-400 text-xs"></i>
                          <div
                            class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 w-52 p-2 bg-dark-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10"
                          >
                            As a % of future sale price (e.g., agent commissions).
                          </div>
                        </div>
                      </label>
                      <div class="flex space-x-2 items-center">
                        <input type="number" value="5" class="w-16 p-1.5 text-xs text-center border rounded-lg" />
                        <span class="text-xs text-dark-500">%</span>
                      </div>
                    </div>

                    <!-- Holding Costs Section -->
                    <div class="text-xs font-semibold text-dark-600 mb-2 mt-4">Holding Costs</div>

                    <div class="flex justify-between items-center">
                      <label class="text-xs font-medium text-dark-600 flex items-center">
                        Annual Property Tax Rate
                        <div class="relative group ml-1">
                          <i class="fas fa-info-circle text-primary-400 text-xs"></i>
                          <div
                            class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 w-52 p-2 bg-dark-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10"
                          >
                            As a % of the property's assessed value each year.
                          </div>
                        </div>
                      </label>
                      <div class="flex space-x-2 items-center">
                        <input
                          type="number"
                          value="1.1"
                          step="0.1"
                          class="w-16 p-1.5 text-xs text-center border rounded-lg"
                        />
                        <span class="text-xs text-dark-500">%</span>
                      </div>
                    </div>

                    <div class="flex justify-between items-center">
                      <label class="text-xs font-medium text-dark-600 flex items-center">
                        Annual Insurance & Maintenance
                        <div class="relative group ml-1">
                          <i class="fas fa-info-circle text-primary-400 text-xs"></i>
                          <div
                            class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 w-52 p-2 bg-dark-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10"
                          >
                            Combined estimate as a % of the property's value each year.
                          </div>
                        </div>
                      </label>
                      <div class="flex space-x-2 items-center">
                        <input
                          type="number"
                          value="1.0"
                          step="0.1"
                          class="w-16 p-1.5 text-xs text-center border rounded-lg"
                        />
                        <span class="text-xs text-dark-500">%</span>
                      </div>
                    </div>

                    <div class="flex justify-between items-center">
                      <label class="text-xs font-medium text-dark-600">Annual HOA Fee</label>
                      <div class="flex space-x-2 items-center">
                        <span class="text-xs text-dark-500">$</span>
                        <input type="number" value="0" class="w-16 p-1.5 text-xs text-center border rounded-lg" />
                      </div>
                    </div>

                    <!-- Tax Implications Section -->
                    <div class="text-xs font-semibold text-dark-600 mb-2 mt-4">Tax Implications</div>

                    <div class="flex justify-between items-center">
                      <label class="text-xs font-medium text-dark-600 flex items-center">
                        Your Marginal Income Tax Rate
                        <div class="relative group ml-1">
                          <i class="fas fa-info-circle text-primary-400 text-xs"></i>
                          <div
                            class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 w-60 p-2 bg-dark-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10"
                          >
                            Your combined federal and state rate. Used to estimate mortgage interest deduction benefits.
                          </div>
                        </div>
                      </label>
                      <div class="flex space-x-2 items-center">
                        <input type="number" value="24" class="w-16 p-1.5 text-xs text-center border rounded-lg" />
                        <span class="text-xs text-dark-500">%</span>
                      </div>
                    </div>

                    <div class="flex justify-between items-center">
                      <label class="text-xs font-medium text-dark-600 flex items-center">
                        Claim Mortgage Interest Deduction?
                        <div class="relative group ml-1">
                          <i class="fas fa-info-circle text-primary-400 text-xs"></i>
                          <div
                            class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 w-60 p-2 bg-dark-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10"
                          >
                            If you itemize deductions on your tax return, you can deduct the interest paid on your
                            mortgage.
                          </div>
                        </div>
                      </label>
                      <div class="flex items-center">
                        <label for="mortgageDeductionToggle" class="flex items-center cursor-pointer">
                          <div class="relative">
                            <input type="checkbox" id="mortgageDeductionToggle" class="sr-only" checked />
                            <div class="block bg-primary-200 w-8 h-4 rounded-full"></div>
                            <div class="dot absolute left-0.5 top-0.5 bg-white w-3 h-3 rounded-full transition"></div>
                          </div>
                        </label>
                      </div>
                    </div>

                    <div class="flex justify-between items-center">
                      <label class="text-xs font-medium text-dark-600">Capital Gains Tax Rate (Property Sale)</label>
                      <div class="flex space-x-2 items-center">
                        <input type="number" value="15" class="w-16 p-1.5 text-xs text-center border rounded-lg" />
                        <span class="text-xs text-dark-500">%</span>
                      </div>
                    </div>

                    <div class="flex justify-between items-center">
                      <label class="text-xs font-medium text-dark-600 flex items-center">
                        Tax-Free Capital Gain Amount (Home Sale)
                        <div class="relative group ml-1">
                          <i class="fas fa-info-circle text-primary-400 text-xs"></i>
                          <div
                            class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 w-60 p-2 bg-dark-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10"
                          >
                            $250,000 for single, $500,000 for married filing jointly in the US.
                          </div>
                        </div>
                      </label>
                      <div class="flex space-x-2">
                        <div class="flex bg-gray-100 rounded-lg overflow-hidden">
                          <button class="px-2 py-1 text-xs bg-primary-600 text-white font-medium">Married</button>
                          <button class="px-2 py-1 text-xs text-dark-600">Single</button>
                          <button class="px-2 py-1 text-xs text-dark-600">HoH</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Calculate Button -->
                <div class="pt-4">
                  <button
                    class="w-full py-3.5 px-4 text-white font-medium rounded-xl bg-gradient-to-r from-primary-600 to-primary-500 hover:from-primary-700 hover:to-primary-600 transition duration-300 shadow-md"
                  >
                    <i class="fas fa-calculator mr-2"></i> Calculate Result
                  </button>
                </div>
              </div>

              <!-- Rent & Invest Inputs (Hidden by Default) -->
              <div class="space-y-6 hidden" id="rent-invest-tab-content">
                <!-- Monthly Rent -->
                <div>
                  <div class="flex justify-between mb-3">
                    <label class="text-sm font-medium text-dark-700">Monthly Rent</label>
                    <div class="px-3 py-1 bg-secondary-100 text-secondary-700 rounded-lg font-semibold text-sm">
                      $6,000
                    </div>
                  </div>
                  <input
                    type="range"
                    min="1000"
                    max="10000"
                    value="6000"
                    step="100"
                    class="w-full"
                    data-id="monthlyRent"
                  />
                  <div class="flex justify-between text-xs text-dark-400 mt-1">
                    <span>$1K</span>
                    <span>$10K</span>
                  </div>
                </div>

                <!-- Rent Increase -->
                <div>
                  <div class="flex justify-between mb-3">
                    <label class="text-sm font-medium text-dark-700">Expected Annual Rent Increase</label>
                    <div class="px-3 py-1 bg-secondary-100 text-secondary-700 rounded-lg font-semibold text-sm">
                      3.5%
                    </div>
                  </div>
                  <input type="range" min="0" max="10" value="3.5" step="0.5" class="w-full" data-id="rentIncrease" />
                  <div class="flex justify-between text-xs text-dark-400 mt-1">
                    <span>0%</span>
                    <span>10%</span>
                  </div>
                  <div class="mt-2 flex items-center">
                    <input type="checkbox" id="sameAsAppreciationRate" class="mr-2" checked />
                    <label for="sameAsAppreciationRate" class="text-xs text-dark-500"
                      >Same as home appreciation rate</label
                    >
                  </div>
                </div>

                <!-- Investment Type -->
                <div>
                  <div class="flex justify-between mb-3">
                    <label class="text-sm font-medium text-dark-700 flex items-center">
                      Expected Annual Investment Return
                      <div class="relative group ml-1">
                        <i class="fas fa-info-circle text-secondary-400 text-xs"></i>
                        <div
                          class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 w-60 p-2 bg-dark-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10"
                        >
                          Your estimated average annual growth rate for investments.
                        </div>
                      </div>
                    </label>
                    <div
                      id="investmentReturnDisplay"
                      class="px-3 py-1 bg-secondary-100 text-secondary-700 rounded-lg font-semibold text-sm"
                    >
                      8%
                    </div>
                  </div>
                  <div class="grid grid-cols-3 gap-2">
                    <button class="bg-secondary-500 text-white p-2 rounded-lg text-sm font-medium">SPY</button>
                    <button class="bg-gray-100 text-dark-500 p-2 rounded-lg text-sm font-medium">QQQ</button>
                    <button class="bg-gray-100 text-dark-500 p-2 rounded-lg text-sm font-medium">Custom</button>
                  </div>
                  <div class="flex justify-between items-center mt-3">
                    <span class="text-xs text-dark-500">Annual Return Rate</span>
                    <span id="investmentReturnValue" class="text-xs font-medium text-secondary-700">8%</span>
                  </div>
                  <!-- Custom slider (initially hidden) -->
                  <div id="customReturnRateSlider" class="hidden mt-3">
                    <input type="range" min="0" max="30" value="8" step="0.25" class="w-full" />
                    <div class="flex justify-between text-xs text-dark-400 mt-1">
                      <span>0%</span>
                      <span>30%</span>
                    </div>
                  </div>
                </div>

                <!-- Capital Gains Tax Rate -->
                <div>
                  <div class="flex justify-between mb-3">
                    <label class="text-sm font-medium text-dark-700 flex items-center">
                      Capital Gains Tax Rate
                      <div class="relative group ml-1">
                        <i class="fas fa-info-circle text-secondary-400 text-xs"></i>
                        <div
                          class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 w-96 p-3 bg-dark-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10 max-h-96 overflow-y-auto"
                        >
                          <p class="mb-2">
                            Tax rate on profits when investments are sold. Based on your income and filing status:
                          </p>
                          <table class="w-full text-xs border-collapse">
                            <thead class="bg-dark-700">
                              <tr>
                                <th class="p-1 text-left">Filing Status</th>
                                <th class="p-1 text-left">Income Range</th>
                                <th class="p-1 text-right">Rate</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr class="border-b border-dark-600">
                                <td class="p-1 font-medium" rowspan="4">Single</td>
                                <td class="p-1">$0 â€“ $48,350</td>
                                <td class="p-1 text-right">0%</td>
                              </tr>
                              <tr class="border-b border-dark-600">
                                <td class="p-1">$48,351 â€“ $200,000</td>
                                <td class="p-1 text-right">15%</td>
                              </tr>
                              <tr class="border-b border-dark-600">
                                <td class="p-1">$200,001 â€“ $533,400</td>
                                <td class="p-1 text-right">18.8%</td>
                              </tr>
                              <tr class="border-b border-dark-600">
                                <td class="p-1">Over $533,400</td>
                                <td class="p-1 text-right">23.8%</td>
                              </tr>

                              <tr class="border-b border-dark-600">
                                <td class="p-1 font-medium" rowspan="4">Married Filing Jointly</td>
                                <td class="p-1">$0 â€“ $96,700</td>
                                <td class="p-1 text-right">0%</td>
                              </tr>
                              <tr class="border-b border-dark-600">
                                <td class="p-1">$96,701 â€“ $250,000</td>
                                <td class="p-1 text-right">15%</td>
                              </tr>
                              <tr class="border-b border-dark-600">
                                <td class="p-1">$250,001 â€“ $600,050</td>
                                <td class="p-1 text-right">18.8%</td>
                              </tr>
                              <tr class="border-b border-dark-600">
                                <td class="p-1">Over $600,050</td>
                                <td class="p-1 text-right">23.8%</td>
                              </tr>

                              <tr class="border-b border-dark-600">
                                <td class="p-1 font-medium" rowspan="4">Head of Household</td>
                                <td class="p-1">$0 â€“ $64,750</td>
                                <td class="p-1 text-right">0%</td>
                              </tr>
                              <tr class="border-b border-dark-600">
                                <td class="p-1">$64,751 â€“ $200,000</td>
                                <td class="p-1 text-right">15%</td>
                              </tr>
                              <tr class="border-b border-dark-600">
                                <td class="p-1">$200,001 â€“ $566,700</td>
                                <td class="p-1 text-right">18.8%</td>
                              </tr>
                              <tr>
                                <td class="p-1">Over $566,700</td>
                                <td class="p-1 text-right">23.8%</td>
                              </tr>
                            </tbody>
                          </table>
                          <p class="mt-2 text-xs">
                            Includes Long-Term Capital Gains Tax + Net Investment Income Tax where applicable.
                          </p>
                        </div>
                      </div>
                    </label>
                  </div>
                  <div class="grid grid-cols-4 gap-2">
                    <label
                      class="bg-gray-100 hover:bg-gray-200 text-dark-600 text-center p-2 rounded-lg text-sm font-medium cursor-pointer flex items-center justify-center"
                    >
                      <input type="radio" name="capitalGainsTaxRate" value="0" class="hidden" />
                      <span>0%</span>
                    </label>
                    <label
                      class="bg-secondary-500 hover:bg-secondary-600 text-white text-center p-2 rounded-lg text-sm font-medium cursor-pointer flex items-center justify-center"
                    >
                      <input type="radio" name="capitalGainsTaxRate" value="15" checked class="hidden" />
                      <span>15%</span>
                    </label>
                    <label
                      class="bg-gray-100 hover:bg-gray-200 text-dark-600 text-center p-2 rounded-lg text-sm font-medium cursor-pointer flex items-center justify-center"
                    >
                      <input type="radio" name="capitalGainsTaxRate" value="18.8" class="hidden" />
                      <span>18.8%</span>
                    </label>
                    <label
                      class="bg-gray-100 hover:bg-gray-200 text-dark-600 text-center p-2 rounded-lg text-sm font-medium cursor-pointer flex items-center justify-center"
                    >
                      <input type="radio" name="capitalGainsTaxRate" value="23.8" class="hidden" />
                      <span>23.8%</span>
                    </label>
                  </div>
                </div>

                <!-- Calculate Button -->
                <div class="pt-4">
                  <button
                    class="w-full py-3.5 px-4 text-white font-medium rounded-xl bg-gradient-to-r from-secondary-600 to-secondary-500 hover:from-secondary-700 hover:to-secondary-600 transition duration-300 shadow-md"
                  >
                    <i class="fas fa-calculator mr-2"></i> Calculate Result
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Section: Results -->
          <div class="w-full md:w-2/3 space-y-6">
            <!-- Summary Row -->
            <div class="flex flex-col sm:flex-row gap-4">
              <!-- Buy Card -->
              <div class="card glow-primary p-6 flex-1 border-l-4 border-primary-600">
                <div class="flex justify-between mb-2">
                  <span class="text-xs font-semibold text-primary-600 bg-primary-50 px-2 py-1 rounded-full">
                    <i class="fas fa-home mr-1"></i> Buy a Home
                  </span>
                  <span class="text-xs font-medium text-dark-500">10-Year Result</span>
                </div>
                <h3 class="text-3xl font-bold text-dark-800 mb-2" id="buyNetWorth">$3,124,680</h3>
                <div class="flex items-center text-xs text-dark-500 mb-4">
                  <span class="px-1.5 py-0.5 bg-primary-100 text-primary-700 rounded font-medium mr-1.5">+24.9%</span>
                  <span>Net Worth Growth</span>
                </div>
              </div>

              <!-- Rent Card -->
              <div class="card glow-secondary p-6 flex-1 border-l-4 border-secondary-600">
                <div class="flex justify-between mb-2">
                  <span class="text-xs font-semibold text-secondary-600 bg-secondary-50 px-2 py-1 rounded-full">
                    <i class="fas fa-chart-line mr-1"></i> Rent + Invest
                  </span>
                  <span class="text-xs font-medium text-dark-500">10-Year Result</span>
                </div>
                <h3 class="text-3xl font-bold text-dark-800 mb-2" id="rentNetWorth">$2,845,200</h3>
                <div class="flex items-center text-xs text-dark-500 mb-4">
                  <span class="px-1.5 py-0.5 bg-secondary-100 text-secondary-700 rounded font-medium mr-1.5"
                    >+13.8%</span
                  >
                  <span>Net Worth Growth</span>
                </div>
              </div>
            </div>

            <!-- Chart Card -->
            <div class="card p-6">
              <div class="flex justify-between items-center mb-6">
                <div>
                  <h3 class="font-semibold text-dark-800">Net Worth Projection</h3>
                  <p class="text-xs text-dark-400">10-year projection based on current parameters</p>
                </div>
                <!-- Chart Cash Out Toggle -->
                <div class="flex items-center space-x-1.5">
                  <span class="text-xs text-primary-600">Cash Out</span>
                  <label for="chartCashOutToggle" class="flex items-center cursor-pointer">
                    <div class="relative">
                      <input type="checkbox" id="chartCashOutToggle" class="sr-only" checked />
                      <div class="block bg-indigo-200 w-8 h-4 rounded-full"></div>
                      <div class="dot absolute left-0.5 top-0.5 bg-white w-3 h-3 rounded-full transition"></div>
                    </div>
                  </label>
                </div>
              </div>
              <div class="h-80">
                <div id="netWorthChart"></div>
              </div>
            </div>

            <!-- Cash-Outflow Card -->
            <div class="card p-6">
              <div class="flex justify-between items-center mb-6">
                <div>
                  <h3 class="font-semibold text-dark-800">Cash Outflows</h3>
                  <p class="text-xs text-dark-400">Compare money that actually leaves your pocket</p>
                </div>

                <!-- Toggle Total / Yearly -->
                <div class="flex items-center space-x-3">
                  <span class="text-xs text-primary-600">Total</span>
                  <label for="cashModeToggle" class="flex items-center cursor-pointer">
                    <div class="relative">
                      <input type="checkbox" id="cashModeToggle" class="sr-only" />
                      <div class="block bg-indigo-200 w-8 h-4 rounded-full"></div>
                      <div class="dot absolute left-0.5 top-0.5 bg-white w-3 h-3 rounded-full transition"></div>
                    </div>
                  </label>
                  <span class="text-xs text-primary-600">Yearly</span>
                </div>
              </div>

              <div class="h-72">
                <div id="cashOutChart"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <footer class="mt-8 pt-6 border-t border-gray-200 text-center">
          <div class="flex justify-center space-x-6 mb-4">
            <button class="text-dark-400 hover:text-primary-600 text-sm transition">
              <i class="fas fa-file-alt mr-1"></i> Assumptions
            </button>
            <button class="text-dark-400 hover:text-primary-600 text-sm transition">
              <i class="fas fa-download mr-1"></i> Export Data
            </button>
            <button class="text-dark-400 hover:text-primary-600 text-sm transition">
              <i class="fas fa-redo-alt mr-1"></i> Reset
            </button>
          </div>
          <p class="text-xs text-dark-400">
            Data based on historical market trends (2015-2025). Results are projections and not guaranteed.
          </p>
          <p class="text-xs text-dark-400 mt-1">
            Â© 2025 Buy vs. Rent Financial Calculator |
            <span class="text-primary-600">Privacy Policy</span>
          </p>
        </footer>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        var chart;

        // Advanced Options Toggle
        const advancedOptionsToggle = document.getElementById("advancedOptionsToggle");
        const advancedOptionsContent = document.getElementById("advancedOptionsContent");

        if (advancedOptionsToggle && advancedOptionsContent) {
          // Initially hide the advanced options
          advancedOptionsContent.style.display = "none";

          advancedOptionsToggle.addEventListener("click", function () {
            const icon = this.querySelector("i");

            if (advancedOptionsContent.style.display === "none") {
              advancedOptionsContent.style.display = "block";
              icon.classList.remove("fa-chevron-down");
              icon.classList.add("fa-chevron-up");
            } else {
              advancedOptionsContent.style.display = "none";
              icon.classList.remove("fa-chevron-up");
              icon.classList.add("fa-chevron-down");
            }
          });
        }

        // Investment Type Buttons
        const investmentButtons = document.querySelectorAll("#rent-invest-tab-content .grid button");
        const customReturnSlider = document.getElementById("customReturnRateSlider");
        const returnRateDisplay = document.querySelector("#investmentReturnValue");
        const returnHeaderDisplay = document.querySelector("#investmentReturnDisplay");

        if (investmentButtons.length > 0 && customReturnSlider) {
          // Investment returns for each option
          const returns = {
            SPY: "8%",
            QQQ: "9.25%",
            Custom: "8%",
          };

          investmentButtons.forEach((button) => {
            button.addEventListener("click", function () {
              // Reset all buttons
              investmentButtons.forEach((btn) => {
                btn.classList.remove("bg-secondary-500", "text-white");
                btn.classList.add("bg-gray-100", "text-dark-500");
              });

              // Highlight clicked button
              this.classList.remove("bg-gray-100", "text-dark-500");
              this.classList.add("bg-secondary-500", "text-white");

              const investmentType = this.textContent.trim();

              // Show/hide custom slider
              if (investmentType === "Custom") {
                customReturnSlider.classList.remove("hidden");
              } else {
                customReturnSlider.classList.add("hidden");

                // Update the return rate display
                const returnValue = returns[investmentType];
                if (returnRateDisplay) {
                  returnRateDisplay.textContent = returnValue;
                }

                // Update the header value display
                if (returnHeaderDisplay) {
                  returnHeaderDisplay.textContent = returnValue;
                }
              }
            });
          });

          // Custom slider event
          const customSlider = customReturnSlider.querySelector("input[type='range']");
          if (customSlider) {
            customSlider.addEventListener("input", function () {
              const value = this.value;

              if (returnRateDisplay) {
                returnRateDisplay.textContent = `${value}%`;
              }

              // Update the header value display
              if (returnHeaderDisplay) {
                returnHeaderDisplay.textContent = `${value}%`;
              }
            });
          }
        }

        // Capital Gains Tax Rate Radio Buttons
        const capitalGainsTaxRateRadios = document.querySelectorAll('input[name="capitalGainsTaxRate"]');

        if (capitalGainsTaxRateRadios.length > 0) {
          capitalGainsTaxRateRadios.forEach((radio) => {
            radio.addEventListener("change", function () {
              // Reset all radio button labels
              capitalGainsTaxRateRadios.forEach((r) => {
                const label = r.closest("label");
                label.classList.remove("bg-secondary-500", "hover:bg-secondary-600", "text-white");
                label.classList.add("bg-gray-100", "hover:bg-gray-200", "text-dark-600");
              });

              // Highlight the selected radio button label
              const selectedLabel = this.closest("label");
              selectedLabel.classList.remove("bg-gray-100", "hover:bg-gray-200", "text-dark-600");
              selectedLabel.classList.add("bg-secondary-500", "hover:bg-secondary-600", "text-white");
            });
          });
        }

        // Same as home appreciation checkbox handler
        const sameAsAppreciationCheckbox = document.getElementById("sameAsAppreciationRate");
        const rentIncreaseSlider = document.querySelector('input[data-id="rentIncrease"]');
        const homeAppreciationSlider = document.querySelector('input[data-id="homeAppreciation"]');

        if (sameAsAppreciationCheckbox && rentIncreaseSlider && homeAppreciationSlider) {
          // Function to update rent increase to match home appreciation
          const updateRentIncreaseFromAppreciation = () => {
            if (sameAsAppreciationCheckbox.checked) {
              const appreciationValue = parseFloat(homeAppreciationSlider.value);
              rentIncreaseSlider.value = appreciationValue;

              // Also update the display
              const rentIncreaseDisplay = rentIncreaseSlider.parentElement.querySelector(".px-3.py-1");
              if (rentIncreaseDisplay) {
                rentIncreaseDisplay.textContent = `${appreciationValue}%`;
              }

              // Disable the slider when checkbox is checked
              rentIncreaseSlider.disabled = true;
              rentIncreaseSlider.classList.add("opacity-50");
            } else {
              // Enable the slider when checkbox is unchecked
              rentIncreaseSlider.disabled = false;
              rentIncreaseSlider.classList.remove("opacity-50");
            }
          };

          // Initial setup
          updateRentIncreaseFromAppreciation();

          // Listen for checkbox changes
          sameAsAppreciationCheckbox.addEventListener("change", updateRentIncreaseFromAppreciation);

          // Listen for home appreciation changes when checkbox is checked
          homeAppreciationSlider.addEventListener("input", () => {
            if (sameAsAppreciationCheckbox.checked) {
              updateRentIncreaseFromAppreciation();
            }
          });

          // Listen for rent increase slider manual changes (enable only when checkbox is unchecked)
          rentIncreaseSlider.addEventListener("input", function () {
            if (!sameAsAppreciationCheckbox.checked) {
              const value = this.value;
              const rentIncreaseDisplay = this.parentElement.querySelector(".px-3.py-1");
              if (rentIncreaseDisplay) {
                rentIncreaseDisplay.textContent = `${value}%`;
              }
            }
          });
        }

        // City Defaults Data
        const cityDefaults = {
          sunnyvale: {
            housePrice: 2350000,
            downPayment: 20,
            interestRate: 6.5,
            propertyTax: 1.22,
            monthlyRent: 5800,
            rentIncrease: 5.2,
          },
          fremont: {
            housePrice: 1850000,
            downPayment: 20,
            interestRate: 6.5,
            propertyTax: 1.25,
            monthlyRent: 4500,
            rentIncrease: 4.8,
          },
          bayarea: {
            housePrice: 2500000,
            downPayment: 25,
            interestRate: 6.75,
            propertyTax: 1.2,
            monthlyRent: 6000,
            rentIncrease: 5,
          },
          seattle: {
            housePrice: 1350000,
            downPayment: 20,
            interestRate: 6.25,
            propertyTax: 0.92,
            monthlyRent: 3800,
            rentIncrease: 4.5,
          },
          austin: {
            housePrice: 750000,
            downPayment: 15,
            interestRate: 6.1,
            propertyTax: 1.8,
            monthlyRent: 2800,
            rentIncrease: 3.9,
          },
          boston: {
            housePrice: 1250000,
            downPayment: 20,
            interestRate: 6.38,
            propertyTax: 1.15,
            monthlyRent: 3900,
            rentIncrease: 4.2,
          },
          nyc: {
            housePrice: 2100000,
            downPayment: 20,
            interestRate: 6.4,
            propertyTax: 0.85,
            monthlyRent: 5500,
            rentIncrease: 5.5,
          },
          toronto: {
            housePrice: 1450000,
            downPayment: 20,
            interestRate: 5.85,
            propertyTax: 0.65,
            monthlyRent: 3500,
            rentIncrease: 4.0,
          },
          default: {
            housePrice: 2500000,
            downPayment: 25,
            interestRate: 6.75,
            propertyTax: 1.2,
            monthlyRent: 6000,
            rentIncrease: 5,
          },
        };

        // City Defaults Handler
        const cityDefaultsDropdown = document.getElementById("cityDefaults");
        cityDefaultsDropdown.addEventListener("change", function () {
          const selectedCity = this.value;
          const cityData = cityDefaults[selectedCity];

          // Update Buy parameters
          updateRangeAndDisplay("housePrice", cityData.housePrice);
          updateRangeAndDisplay("downPayment", cityData.downPayment);
          updateRangeAndDisplay("interestRate", cityData.interestRate);
          updateRangeAndDisplay("propertyTax", cityData.propertyTax);

          // Update Rent parameters
          updateRangeAndDisplay("monthlyRent", cityData.monthlyRent);
          updateRangeAndDisplay("rentIncrease", cityData.rentIncrease);

          // Update calculated fields
          updateInitialInvestment(cityData.housePrice, cityData.downPayment);

          // Show a notification
          showNotification(
            `Loaded defaults for ${
              selectedCity === "default" ? "Smart Defaults" : this.options[this.selectedIndex].text
            }`
          );
        });

        // Helper function to update range inputs and their displays
        function updateRangeAndDisplay(id, value) {
          const rangeInput = document.querySelector(`input[type="range"][data-id="${id}"]`);
          if (!rangeInput) return;

          rangeInput.value = value;
          const displayElement = rangeInput.parentElement.querySelector(".px-3.py-1");

          if (displayElement) {
            // Format the display based on the input type
            if (id === "housePrice" || id === "monthlyRent") {
              displayElement.textContent = `$${numberWithCommas(value)}`;
            } else if (id === "downPayment" || id === "propertyTax" || id === "interestRate" || id === "rentIncrease") {
              displayElement.textContent = `${value}%`;
            } else {
              displayElement.textContent = value;
            }
          }
        }

        // Helper function to format numbers with commas
        function numberWithCommas(x) {
          return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Helper function to update the initial investment field based on house price and down payment
        function updateInitialInvestment(housePrice, downPaymentPercent) {
          const downPayment = (housePrice * downPaymentPercent) / 100;
          const closingCost = housePrice * 0.01; // 1% closing cost
          const initialInvestment = downPayment + closingCost;

          const initialInvestmentInput = document.querySelector("input[data-tooltip]");
          if (initialInvestmentInput) {
            initialInvestmentInput.value = Math.round(initialInvestment);
            initialInvestmentInput.setAttribute(
              "data-tooltip",
              `Down payment ($${numberWithCommas(downPayment)}) + Closing costs ($${numberWithCommas(closingCost)})`
            );
          }
        }

        // Update down payment display when slider changes
        const downPaymentSlider = document.querySelector('input[data-id="downPayment"]');
        const housePriceSlider = document.querySelector('input[data-id="housePrice"]');

        if (downPaymentSlider && housePriceSlider) {
          const updateDownPaymentDisplay = () => {
            const downPaymentPercentage = parseFloat(downPaymentSlider.value);
            const housePrice = parseFloat(housePriceSlider.value);
            const downPaymentAmount = (housePrice * downPaymentPercentage) / 100;

            const displayElement = downPaymentSlider.parentElement.querySelector(".px-3.py-1");
            if (displayElement) {
              displayElement.textContent = `${downPaymentPercentage}% ($${numberWithCommas(downPaymentAmount)})`;
            }
          };

          downPaymentSlider.addEventListener("input", updateDownPaymentDisplay);
          housePriceSlider.addEventListener("input", updateDownPaymentDisplay);
        }

        // Show a temporary notification
        function showNotification(message) {
          const notification = document.createElement("div");
          notification.className =
            "fixed top-4 right-4 bg-dark-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in-out";
          notification.innerHTML = `<i class="fas fa-info-circle mr-2"></i>${message}`;
          document.body.appendChild(notification);

          setTimeout(() => {
            notification.classList.add("opacity-0");
            setTimeout(() => notification.remove(), 500);
          }, 3000);
        }

        // Add data attributes to range inputs for identification
        document.querySelectorAll('input[type="range"]').forEach((input) => {
          const label = input.parentElement.querySelector("label");
          if (label) {
            const labelText = label.textContent.trim().toLowerCase();
            if (labelText === "house price") input.setAttribute("data-id", "housePrice");
            else if (labelText === "down payment") input.setAttribute("data-id", "downPayment");
            else if (labelText === "interest rate") input.setAttribute("data-id", "interestRate");
            else if (labelText === "property tax") input.setAttribute("data-id", "propertyTax");
            else if (labelText === "monthly rent") input.setAttribute("data-id", "monthlyRent");
            else if (labelText === "annual rent increase") input.setAttribute("data-id", "rentIncrease");
          }
        });

        // Base Data
        const baseCategories = [
          "Year 0",
          "Year 1",
          "Year 2",
          "Year 3",
          "Year 4",
          "Year 5",
          "Year 6",
          "Year 7",
          "Year 8",
          "Year 9",
          "Year 10",
        ];
        const buyData = [
          625000, 748000, 890000, 1040000, 1200000, 1390000, 1610000, 1870000, 2190000, 2580000, 3124680,
        ];
        const rentInvestData = [
          625000, 710000, 820000, 945000, 1090000, 1280000, 1510000, 1770000, 2090000, 2420000, 2845200,
        ];

        // Estimated Cash Out Values (Year 10 - costs)
        // Example: 5% selling cost for Buy, 24% capital gains for Rent+Invest diff
        const buyCashOutValue = buyData[10] * (1 - 0.05);
        const rentInvestCashOutValue =
          rentInvestData[10] * (1 - 0.24 * ((rentInvestData[10] - rentInvestData[0]) / rentInvestData[10])); // Simplified CG tax

        const updateChartData = (showCashOut) => {
          let seriesData;
          let categoriesData;

          if (showCashOut) {
            seriesData = [
              { name: "Buy a Home", data: [...buyData, buyCashOutValue] },
              { name: "Rent + Invest", data: [...rentInvestData, rentInvestCashOutValue] },
            ];
            categoriesData = [...baseCategories, "Cash Out"];
          } else {
            seriesData = [
              { name: "Buy a Home", data: buyData },
              { name: "Rent + Invest", data: rentInvestData },
            ];
            categoriesData = baseCategories;
          }

          const options = {
            series: seriesData,
            chart: {
              height: 320,
              type: "area",
              fontFamily: "Montserrat, sans-serif",
              toolbar: { show: false },
              zoom: { enabled: false },
            },
            dataLabels: { enabled: false },
            stroke: { curve: "smooth", width: 3 },
            colors: ["#8b5cf6", "#10b981"],
            fill: {
              type: "gradient",
              gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.1, stops: [0, 100] },
            },
            markers: { size: 5, strokeWidth: 2, hover: { size: 7 } },
            xaxis: {
              categories: categoriesData,
              labels: { style: { colors: "#64748b", fontSize: "12px", fontWeight: 500 } },
            },
            yaxis: {
              labels: {
                formatter: function (value) {
                  return new Intl.NumberFormat("en-US", {
                    style: "currency",
                    currency: "USD",
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0,
                  }).format(value);
                },
              },
            },
            tooltip: {
              y: {
                formatter: function (value) {
                  return new Intl.NumberFormat("en-US", {
                    style: "currency",
                    currency: "USD",
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0,
                  }).format(value);
                },
              },
            },
            legend: {
              position: "top",
              horizontalAlign: "right",
              fontSize: "13px",
              fontWeight: 500,
              markers: { width: 14, height: 14, radius: 100 },
              itemMargin: { horizontal: 15 },
            },
          };

          if (!chart) {
            chart = new ApexCharts(document.querySelector("#netWorthChart"), options);
            chart.render();
          } else {
            chart.updateOptions(options);
          }

          // Update the net worth cards based on cash out toggle
          const buyNetWorth = document.getElementById("buyNetWorth");
          const rentNetWorth = document.getElementById("rentNetWorth");

          if (showCashOut) {
            buyNetWorth.textContent = formatCurrency(buyCashOutValue);
            rentNetWorth.textContent = formatCurrency(rentInvestCashOutValue);
          } else {
            buyNetWorth.textContent = formatCurrency(buyData[10]);
            rentNetWorth.textContent = formatCurrency(rentInvestData[10]);
          }
        };

        // Helper function to format currency
        function formatCurrency(value) {
          return new Intl.NumberFormat("en-US", {
            style: "currency",
            currency: "USD",
            minimumFractionDigits: 0,
            maximumFractionDigits: 0,
          }).format(value);
        }

        // Chart Toggle Functionality
        const chartCashOutToggle = document.getElementById("chartCashOutToggle");
        chartCashOutToggle.addEventListener("change", (event) => {
          updateChartData(event.target.checked);
        });

        // Initial Chart Render
        updateChartData(chartCashOutToggle.checked);

        /* ---------- Cash-Outflow CHART ---------- */

        // dummy yearly numbers â€“ replace with your real model later
        const buyCashAnnual = [625000, 145000, 148000, 150000, 152000, 154000, 156000, 158000, 160000, 162000];
        const rentCashAnnual = [72000, 75600, 79380, 83349, 87516, 91891, 96486, 101410, 106681, 112315];

        // helper to build cumulative series from annual
        const cumSum = (arr) =>
          arr.reduce((acc, v, i) => {
            acc.push((acc[i - 1] || 0) + v);
            return acc;
          }, []);

        const buyCashTotal = cumSum(buyCashAnnual);
        const rentCashTotal = cumSum(rentCashAnnual);

        let cashChart; // keeps the ApexCharts instance

        function renderCashChart(showYearly) {
          const categories = Array.from({ length: 10 }, (_, i) => `Year ${i + 1}`);
          const series = showYearly
            ? [
                { name: "Buy (annual)", type: "column", data: buyCashAnnual },
                { name: "Rent (annual)", type: "column", data: rentCashAnnual },
                { name: "Invested diff", type: "column", data: buyCashAnnual.map((v, i) => v - rentCashAnnual[i]) },
              ]
            : [
                { name: "Buy â€“ cumulative", type: "area", data: buyCashTotal },
                { name: "Rent â€“ cumulative", type: "area", data: rentCashTotal },
                { name: "Invested diff", type: "area", data: buyCashTotal.map((v, i) => v - rentCashTotal[i]) },
              ];

          const options = {
            series,
            chart: {
              height: 300,
              stacked: showYearly, // stacked bars for yearly mode
              type: showYearly ? "bar" : "area",
              fontFamily: "Montserrat, sans-serif",
              toolbar: { show: false },
              zoom: { enabled: false },
            },
            stroke: { curve: "smooth", width: showYearly ? 0 : 3 },
            fill: { opacity: showYearly ? 1 : 0.15 },
            colors: ["#8b5cf6", "#10b981", "#f59e0b"],
            dataLabels: { enabled: false },
            xaxis: { categories },
            yaxis: {
              labels: {
                formatter: (v) =>
                  v.toLocaleString("en-US", { style: "currency", currency: "USD", maximumFractionDigits: 0 }),
              },
            },
            tooltip: { shared: true, intersect: false },
          };

          if (!cashChart) {
            cashChart = new ApexCharts(document.querySelector("#cashOutChart"), options);
            cashChart.render();
          } else {
            cashChart.updateOptions(options);
          }
        }

        // initial draw
        const cashModeToggle = document.getElementById("cashModeToggle");
        renderCashChart(cashModeToggle.checked);

        // toggle handler
        cashModeToggle.addEventListener("change", (e) => renderCashChart(e.target.checked));

        // Tab switching functionality
        const buyTab = document.querySelector("button:has(> i.fa-home)");
        const rentInvestTab = document.querySelector("button:has(> i.fa-key)");
        const buyTabContent = document.getElementById("buy-tab-content");
        const rentInvestTabContent = document.getElementById("rent-invest-tab-content");

        buyTab.addEventListener("click", () => {
          buyTab.classList.add("tab-active");
          rentInvestTab.classList.remove("tab-active");
          buyTab.classList.remove("text-dark-400");
          buyTab.classList.add("text-dark-800");
          rentInvestTab.classList.remove("text-dark-800");
          rentInvestTab.classList.add("text-dark-400");

          buyTabContent.classList.remove("hidden");
          rentInvestTabContent.classList.add("hidden");
        });

        rentInvestTab.addEventListener("click", () => {
          rentInvestTab.classList.add("tab-active");
          buyTab.classList.remove("tab-active");
          rentInvestTab.classList.remove("text-dark-400");
          rentInvestTab.classList.add("text-dark-800");
          buyTab.classList.remove("text-dark-800");
          buyTab.classList.add("text-dark-400");

          rentInvestTabContent.classList.remove("hidden");
          buyTabContent.classList.add("hidden");
        });

        // Toggle details section
        document.getElementById("toggleDetails").addEventListener("click", function () {
          const detailsSection = document.getElementById("detailsSection");
          const detailsIcon = document.getElementById("detailsIcon");
          const detailsText = document.getElementById("detailsText");

          detailsSection.classList.toggle("hidden");

          if (detailsSection.classList.contains("hidden")) {
            detailsIcon.classList.remove("fa-chevron-up");
            detailsIcon.classList.add("fa-chevron-down");
            detailsText.textContent = "Show details";
          } else {
            detailsIcon.classList.remove("fa-chevron-down");
            detailsIcon.classList.add("fa-chevron-up");
            detailsText.textContent = "Hide details";
          }
        });

        // Net Worth Card Toggle Functionality
        const cashOutToggle = document.getElementById("cashOutToggle");
        const netWorthDescription = document.getElementById("netWorthDescription");
        const capitalGainsTaxRate = 24; // Example value, should be linked to input later

        const updateDescription = () => {
          if (cashOutToggle.checked) {
            netWorthDescription.textContent = `Net worth @ year 10 after selling house (5% fee) vs. cashing out investments (${capitalGainsTaxRate}% capital gains tax)`;
          } else {
            netWorthDescription.textContent = `Net worth @ year 10 with property equity and investment portfolio value (no liquidation)`;
          }
        };

        cashOutToggle.addEventListener("change", updateDescription);

        // Initial description update
        updateDescription();

        // Time horizon selector functionality
        const timeHorizonButtons = document.querySelectorAll(".time-horizon-btn");
        let currentTimeHorizon = 10;

        // Sample data for different time horizons (replace with your actual calculation logic)
        const projectionData = {
          10: {
            futureHomeValue: "$3,500,000",
            buyNetWorth: "$3,120,000",
            rentNetWorth: "$2,850,000",
            buyPropertyValue: "$3,500,000",
            buyMortgageBalance: "-$380,000",
            rentInitialInvestment: "$625,000",
            rentAccumulatedInvestments: "$1,180,000",
            rentInvestmentGrowth: "$1,045,000",
          },
          15: {
            futureHomeValue: "$4,200,000",
            buyNetWorth: "$4,050,000",
            rentNetWorth: "$4,850,000",
            buyPropertyValue: "$4,200,000",
            buyMortgageBalance: "-$150,000",
            rentInitialInvestment: "$625,000",
            rentAccumulatedInvestments: "$1,950,000",
            rentInvestmentGrowth: "$2,275,000",
          },
          20: {
            futureHomeValue: "$5,050,000",
            buyNetWorth: "$5,050,000",
            rentNetWorth: "$8,250,000",
            buyPropertyValue: "$5,050,000",
            buyMortgageBalance: "$0",
            rentInitialInvestment: "$625,000",
            rentAccumulatedInvestments: "$3,200,000",
            rentInvestmentGrowth: "$4,425,000",
          },
          30: {
            futureHomeValue: "$7,250,000",
            buyNetWorth: "$7,250,000",
            rentNetWorth: "$17,800,000",
            buyPropertyValue: "$7,250,000",
            buyMortgageBalance: "$0",
            rentInitialInvestment: "$625,000",
            rentAccumulatedInvestments: "$6,850,000",
            rentInvestmentGrowth: "$10,325,000",
          },
        };

        function updateProjectionDisplay(years) {
          const data = projectionData[years];

          // Update main text
          document.getElementById("future-home-value").textContent = data.futureHomeValue;
          document.getElementById("projection-years").textContent = years;
          document.getElementById("buy-net-worth").textContent = data.buyNetWorth;
          document.getElementById("rent-net-worth").textContent = data.rentNetWorth;

          // Update breakdown cards
          const buyCard = document.querySelector(".border-primary-500");
          if (buyCard) {
            buyCard.querySelector(".text-lg.font-bold.text-primary-600").textContent = data.buyNetWorth;
            const buyBreakdown = buyCard.querySelectorAll(".flex.justify-between .font-medium");
            buyBreakdown[0].textContent = data.buyPropertyValue;
            buyBreakdown[1].textContent = data.buyMortgageBalance;
            buyBreakdown[2].textContent = data.buyNetWorth;
          }

          const rentCard = document.querySelector(".border-secondary-500");
          if (rentCard) {
            rentCard.querySelector(".text-lg.font-bold.text-secondary-600").textContent = data.rentNetWorth;
            const rentBreakdown = rentCard.querySelectorAll(".flex.justify-between .font-medium");
            rentBreakdown[0].textContent = data.rentInitialInvestment;
            rentBreakdown[1].textContent = data.rentAccumulatedInvestments;
            rentBreakdown[2].textContent = data.rentInvestmentGrowth;
            rentBreakdown[3].textContent = data.rentNetWorth;
          }

          // Update conclusion based on which option is better
          const buyValue = parseFloat(data.buyNetWorth.replace(/[$,]/g, ""));
          const rentValue = parseFloat(data.rentNetWorth.replace(/[$,]/g, ""));
          const conclusionElement = document.querySelector(".bg-primary-600 span");

          if (buyValue > rentValue) {
            conclusionElement.textContent = "Buying is the better option";
            conclusionElement.parentElement.parentElement.className =
              "bg-primary-600 text-white px-4 py-2 rounded-lg inline-block mb-4";
          } else {
            conclusionElement.textContent = "Renting is the better option";
            conclusionElement.parentElement.parentElement.className =
              "bg-secondary-600 text-white px-4 py-2 rounded-lg inline-block mb-4";
          }

          // Update charts if they exist
          if (typeof updateChartData === "function") {
            // This would need to be implemented with actual chart data for different time horizons
            updateChartData(document.getElementById("chartCashOutToggle").checked);
          }
        }

        timeHorizonButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const years = parseInt(this.getAttribute("data-years"));

            // Update button states
            timeHorizonButtons.forEach((btn) => {
              btn.classList.remove("active", "bg-primary-600", "text-white");
              btn.classList.add("text-dark-600", "hover:bg-gray-200");
            });

            this.classList.add("active", "bg-primary-600", "text-white");
            this.classList.remove("text-dark-600", "hover:bg-gray-200");

            currentTimeHorizon = years;
            updateProjectionDisplay(years);

            showNotification(`Projection updated to ${years} years`);
          });
        });

        // Language switch functionality (placeholder for future implementation)
        const languageSwitch = document.getElementById("languageSwitch");
        if (languageSwitch) {
          languageSwitch.addEventListener("change", function () {
            const selectedLanguage = this.value;
            const languageNames = {
              en: "English",
              zh: "ä¸­æ–‡",
              es: "EspaÃ±ol",
              fr: "FranÃ§ais",
            };
            showNotification(`Language switched to ${languageNames[selectedLanguage]} (Feature coming soon!)`);
          });
        }

        // Hero section button handlers
        document.getElementById("edit-inputs-btn").addEventListener("click", function () {
          // Scroll to the parameters section smoothly
          const parametersCard = document.querySelector(".card h2 i.fas.fa-sliders-h").closest(".card");
          parametersCard.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        });

        document.getElementById("share-result-btn").addEventListener("click", function () {
          // Create a shareable URL
          const url = window.location.href;

          // Copy to clipboard
          navigator.clipboard
            .writeText(url)
            .then(function () {
              // Show success notification
              showNotification("Result link copied to clipboard!");
            })
            .catch(function () {
              // Fallback for browsers that don't support clipboard API
              const textarea = document.createElement("textarea");
              textarea.value = url;
              textarea.style.position = "fixed";
              document.body.appendChild(textarea);
              textarea.focus();
              textarea.select();

              try {
                document.execCommand("copy");
                showNotification("Result link copied to clipboard!");
              } catch (err) {
                showNotification("Failed to copy link. Try again later.");
              }

              document.body.removeChild(textarea);
            });
        });
      });
    </script>
  </body>
</html>
